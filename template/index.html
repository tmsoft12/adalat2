<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medya Güncelleme</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
        }
        .media-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px;
        }
        .media-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px;
            padding: 15px;
            width: 250px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.2s;
        }
        .media-item:hover {
            transform: scale(1.05);
        }
        .modal {
            display: none; /* Modal başlangıçta gizli */
            position: fixed;
            z-index: 1; /* En üstte görünmesini sağla */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Gerekirse kaydır */
            background-color: rgba(0, 0, 0, 0.4); /* Şeffaf arka plan */
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; /* Üstten ve alttan boşluk */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Genişlik */
            max-width: 500px; /* Maksimum genişlik */
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Medya Güncelleme</h1>
    <div class="media-list" id="media-list"></div>

    <!-- Modal için HTML -->
    <div id="update-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-modal">&times;</span>
            <h2>Medya Güncelle</h2>
            <form id="form" enctype="multipart/form-data">
                <input type="hidden" name="id" id="media-id" />
                <div id="current-media" style="margin-bottom: 20px;"></div>
                <label for="video">Yeni Video Dosyası:</label>
                <input type="file" name="video" id="video" accept="video/*" />
                <br><br>
                <label for="cover">Yeni Kapak Dosyası:</label>
                <input type="file" name="cover" id="cover" accept="image/*" />
                <br><br>
                <button type="submit">Güncelle</button>
            </form>
        </div>
    </div>

    <script>
        const mediaListElement = document.getElementById('media-list');
        const updateModal = document.getElementById('update-modal');
        const mediaIdElement = document.getElementById('media-id');
        const currentMediaElement = document.getElementById('current-media');
        const closeModalButton = document.getElementById('close-modal');

        // Medya verilerini getir
        async function fetchMedia() {
            try {
                const response = await fetch('http://192.168.100.242:5000/api/admin/media');
                if (!response.ok) throw new Error('Medya verileri alınamadı.');
                const data = await response.json();
                displayMedia(data.media);
            } catch (error) {
                console.error('Hata:', error);
            }
        }

        // Medya verilerini listele
        function displayMedia(mediaItems) {
            mediaListElement.innerHTML = '';
            mediaItems.forEach(media => {
                const mediaItemDiv = document.createElement('div');
                mediaItemDiv.classList.add('media-item');
                mediaItemDiv.innerHTML = `
                    <strong>ID:</strong> ${media.id} <br>
                    <strong>Video:</strong> <a href="${media.video}" target="_blank">Oynat</a> <br>
                    <strong>Kapak:</strong> <img src="${media.cover}" alt="Kapak" style="width: 100px;" /> <br>
                    <button onclick="prepareUpdate(${media.id}, '${media.video}', '${media.cover}')">Güncelle</button>
                `;
                mediaListElement.appendChild(mediaItemDiv);
            });
        }

        // Güncelleme formunu hazırlamak için modal aç
        function prepareUpdate(id, video, cover) {
            mediaIdElement.value = id;
            currentMediaElement.innerHTML = `
                <strong>Mevcut Video:</strong> <a href="${video}" target="_blank">Oynat</a> <br>
                <strong>Mevcut Kapak:</strong> <img src="${cover}" alt="Kapak" style="width: 100px;" /> <br>
            `;
            updateModal.style.display = 'block'; // Modal'ı göster
        }

        // Modalı kapat
        closeModalButton.onclick = function() {
            updateModal.style.display = 'none'; // Modal'ı gizle
        }

        // Form gönderimi
        document.getElementById('form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            const id = formData.get('id');

            try {
                const response = await fetch(`http://192.168.100.242:5000/api/admin/media/${id}`, {
                    method: 'PUT', // veya 'PATCH'
                    body: formData
                });

                if (response.ok) {
                    alert('Medya güncellendi!');
                    fetchMedia(); // Listeyi güncelle
                    updateModal.style.display = 'none'; // Modal'ı gizle
                } else {
                    const errorData = await response.json();
                    alert('Hata: ' + errorData.error);
                }
            } catch (error) {
                console.error('Hata:', error);
                alert('Güncelleme sırasında hata oluştu.');
            }
        });

        // Sayfa yüklendiğinde medya verilerini getir
        window.onload = fetchMedia;

        // Modal dışında bir yere tıklanırsa modalı kapat
        window.onclick = function(event) {
            if (event.target === updateModal) {
                updateModal.style.display = 'none'; // Modal'ı gizle
            }
        }
    </script>
</body>
</html>
